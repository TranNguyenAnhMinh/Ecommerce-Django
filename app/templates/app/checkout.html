{% extends 'app/base.html' %}
{% load static %}
{% block content_checkout %}
<div class="row" style='width: 100%;'>
	<div class="col-lg-6">
		<div class="box-element" id="form-wrapper">
			<!-- <form method="post"id="form" > -->

			<form method="POST">

				{% csrf_token %}
				{% for message in messages %}
				<div class="alert alert-danger">
				  {{ message }}
				</div>
				{% endfor %}
				{% for field in shipping_address_form %}
				<div class="fieldWrapper">
					{{ field.errors }}
					{{ field.label_tag }} {{ field }}
					{% if field.name == 'mobile' %}
					<span class="error">{{ field.errors }}</span>
					{% endif %}
				</div>
				{% endfor %}

				<input id="form-button" class="btn btn-success btn-block" type="submit" value="Đặt hàng">
			</form>


		</div>

		<br>
		<div class="box-element hidden" id="payment-info">
			<small>Paypal Options</small>
		</div>

	</div>

	<div class="col-lg-6">
		<div class="box-element">
			<a class="btn btn-outline-dark" href="{% url 'cart' %}">&#x2190; Quay lại</a>
			<hr>
			<h3>Giỏ hàng</h3>
			<hr>
			{%for item in items%}
			<div class="cart-row">
				<div style="flex:2"><img class="row-image" src="{{item.product.ImageURL}}"></div>
				<div style="flex:2">
					<p>{{item.product.name}}</p>
				</div>
				<div style="flex:1">
					<p>{{item.product.price}}</p>
				</div>
				<div style="flex:1">
					<p>{{item.quantity}}</p>
				</div>
			</div>
			{%endfor%}
			<div style="text-align: left;">
				<h5>Tổng số lượng: {{order.get_cart_items}}</h5>
			</div>
			<div style="text-align: right;">
				<h5>Tổng tiền: {{order.get_cart_total}}₫</h5>
			</div>

		</div>
	</div>
</div>
<script>
	document.getElementById("form").addEventListener("submit", function(event) {
		// Ngăn form được gửi đi ngay lập tức
		event.preventDefault();
	
		// Lấy giá trị của trường số điện thoại
		var mobileField = document.getElementById("id_mobile");
		var mobileValue = mobileField.value;
	
		// Lấy thẻ hiển thị thông báo lỗi
		var errorSpan = document.getElementById("mobile-error");
	
		// Kiểm tra nếu số điện thoại không hợp lệ
		if (!/^\d{10}$/.test(mobileValue)) {
			// Hiển thị thông báo lỗi gần trường số điện thoại
			errorSpan.textContent = "Số điện thoại phải đúng 10 chữ số";
		} else {
			// Nếu hợp lệ, xóa thông báo lỗi
			errorSpan.textContent = "";
			// Tiếp tục gửi form
			this.submit();
		}
	});
	</script>
<!-- <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
	function placeOrder() {

		fetch("{% url 'send_order_email' %}", {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json',
				'X-CSRFToken': "{{ csrf_token }}",
			},
			body: JSON.stringify({

			}),
		})
			.then(response => response.json())
			.then(data => {
				console.log(data);  // In dữ liệu phản hồi từ máy chủ (có thể là thông báo gửi email thành công)
			});

		// Hiển thị thông báo đặt hàng thành công sử dụng SweetAlert2
		Swal.fire({
			icon: 'success',
			title: 'Đặt hàng thành công!',
			text: 'Cảm ơn bạn đã đặt hàng. Chúng tôi sẽ gửi thông tin đơn hàng cho bạn trong thời gian sớm nhất.',
			showConfirmButton: false,
			timer: 3000
		});

		setTimeout(function () {
			window.location.href = "{% url 'home' %}";
		}, 3000);
	}

	document.getElementById("form").addEventListener("submit", function (event) {
		event.preventDefault(); // Ngăn form được gửi đi ngay lập tức
		placeOrder(); // Gọi hàm placeOrder khi nhấn nút "Đặt hàng"
	});
</script> -->
{% endblock content_checkout %}